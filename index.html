<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Slotoking-like Slot</title>
<style>
  body { background:#111; color:#fff; font-family:sans-serif; text-align:center; }
  .grid { display:grid; grid-template-columns:repeat(5,80px); gap:5px; margin:20px auto; }
  .cell { width:80px; height:80px; background:#222; display:flex; align-items:center; justify-content:center; font-size:24px; border-radius:8px; }
  button { padding:10px 20px; font-size:18px; cursor:pointer; }
</style>
</head>
<body>

<h1>ðŸŽ° Slot Demo</h1>
<div class="grid" id="grid"></div>
<button onclick="spin()">SPIN</button>
<p id="info"></p>

<script>
/* ================= GAME STATE ================= */
const GameState = {
  balance: 1000,
  bet: 10,
  totalBets: 0,
  totalWins: 0,
  targetRTP: 0.96
};

/* ================= SYMBOLS ================= */
const SYMBOLS = {
  L1: { payout: 1, type: 'low' },
  L2: { payout: 1.5, type: 'low' },
  M1: { payout: 3, type: 'mid' },
  H1: { payout: 8, type: 'high' },
  W:  { payout: 0, type: 'wild' },
  S:  { payout: 0, type: 'scatter' }
};

/* ================= REEL STRIPS ================= */
const REELS = [
  createStrip(),
  createStrip(),
  createStrip(),
  createStrip(),
  createStrip()
];

function createStrip() {
  const strip = [];
  for (let i = 0; i < 200; i++) {
    const r = Math.random();
    if (r < 0.5) strip.push('L1');
    else if (r < 0.7) strip.push('L2');
    else if (r < 0.85) strip.push('M1');
    else if (r < 0.95) strip.push('H1');
    else if (r < 0.98) strip.push('W');
    else strip.push('S');
  }
  return strip;
}

/* ================= RTP CONTROLLER ================= */
function currentRTP() {
  return GameState.totalBets === 0
    ? GameState.targetRTP
    : GameState.totalWins / GameState.totalBets;
}

/* ================= SCENARIOS ================= */
const SCENARIOS = [
  { name:'LOSS', baseWeight:50 },
  { name:'SMALL_WIN', baseWeight:25 },
  { name:'MEDIUM_WIN', baseWeight:15 },
  { name:'BIG_WIN', baseWeight:3 },
  { name:'NEAR_MISS', baseWeight:7 }
];

function chooseScenario() {
  let rtp = currentRTP();
  let adjusted = SCENARIOS.map(s => {
    let w = s.baseWeight;
    if (rtp < GameState.targetRTP && s.name.includes('WIN')) w *= 1.3;
    if (rtp > GameState.targetRTP && s.name === 'LOSS') w *= 1.4;
    return { ...s, weight: w };
  });

  const total = adjusted.reduce((a,b)=>a+b.weight,0);
  let roll = Math.random() * total;
  for (let s of adjusted) {
    roll -= s.weight;
    if (roll <= 0) return s.name;
  }
}

/* ================= SPIN ENGINE ================= */
function spin() {
  if (GameState.balance < GameState.bet) return;

  GameState.balance -= GameState.bet;
  GameState.totalBets += GameState.bet;

  const scenario = chooseScenario();
  let grid = generateGrid(scenario);
  let win = calculateWin(grid);

  GameState.balance += win;
  GameState.totalWins += win;

  render(grid);
  document.getElementById('info').innerText =
    `Scenario: ${scenario} | Win: ${win} | RTP: ${currentRTP().toFixed(2)}`;
}

/* ================= GRID GENERATION ================= */
function generateGrid(scenario) {
  const grid = Array.from({length:3},()=>Array(5).fill(null));

  for (let r = 0; r < 5; r++) {
    const strip = REELS[r];
    let pos = Math.floor(Math.random() * strip.length);

    for (let row = 0; row < 3; row++) {
      grid[row][r] = strip[(pos + row) % strip.length];
    }
  }

  if (scenario === 'NEAR_MISS') {
    grid[0][0] = 'S';
    grid[1][2] = 'S';
  }

  if (scenario === 'BIG_WIN') {
    grid[1][0] = 'H1';
    grid[1][1] = 'H1';
    grid[1][2] = 'H1';
    grid[1][3] = 'H1';
    grid[1][4] = 'H1';
  }

  return grid;
}

/* ================= PAYLINES ================= */
function calculateWin(grid) {
  let win = 0;
  const line = grid[1]; // Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð°Ñ Ð»Ð¸Ð½Ð¸Ñ

  let symbol = line[0];
  let count = 1;

  for (let i = 1; i < 5; i++) {
    if (line[i] === symbol || line[i] === 'W') count++;
    else break;
  }

  if (count >= 3 && SYMBOLS[symbol]) {
    win = SYMBOLS[symbol].payout * count * GameState.bet;
  }

  return Math.floor(win);
}

/* ================= UI ================= */
function render(grid) {
  const el = document.getElementById('grid');
  el.innerHTML = '';
  grid.flat().forEach(s => {
    const d = document.createElement('div');
    d.className = 'cell';
    d.innerText = s;
    el.appendChild(d);
  });
}
</script>
</body>
</html>






















































































































































































































































































































































































































































































































































